import sys, os

hal_base_path = "/home/simon/projects/hal/"
netlist_path = "/home/simon/data/iphone/simulation_2022_05_02/dsp38.hal"
#gate_library_path = "/home/simon/projects/hal_4_0/hal/plugins/gate_libraries/definitions/lsi_10k.hgl"

sys.path.append(hal_base_path + "build/lib/") #this is where your hal python lib is located
os.environ["HAL_BASE_PATH"] = hal_base_path + "build" # hal base path

import hal_py

#initialize HAL
hal_py.plugin_manager.load_all_plugins()

netlist = hal_py.NetlistFactory.load_netlist(netlist_path)

known_inputs = [{977: 0, 2986: 0, 6003: 0, 3182: 0, 94: 0, 5081: 0, 2634: 1, 3528: 0, 4254: 1, 4735: 0, 2881: 0, 1409: 0, 4307: 0, 2688: 0, 1316: 1, 3459: 0, 1: 0, 6339: 0, 6337: 1, 34: 1, 1528: 1, 7311: 0, 1042: 1, 4006: 1, 4472: 0, 1162: 0, 3094: 0}, {977: 0, 2986: 0, 6003: 0, 3182: 0, 94: 0, 5081: 0, 2634: 1, 3528: 0, 4254: 1, 4735: 0, 2881: 0, 1409: 0, 4307: 0, 2688: 0, 1316: 1, 3459: 0, 1: 0, 6339: 0, 6337: 1, 34: 1, 1528: 1, 7311: 0, 1042: 1, 4006: 1, 4472: 0, 1162: 0, 3094: 0}, {977: 0, 2986: 0, 6003: 0, 3182: 1, 94: 0, 5081: 0, 2634: 1, 3528: 0, 4254: 1, 4735: 0, 2881: 0, 1409: 0, 4307: 0, 2688: 0, 1316: 1, 3459: 0, 1: 0, 6339: 0, 6337: 1, 34: 1, 1528: 1, 7311: 0, 1042: 1, 4006: 1, 4472: 0, 1162: 0, 3094: 0}, {977: 0, 2986: 1, 6003: 0, 3182: 0, 94: 0, 5081: 0, 2634: 0, 3528: 0, 4254: 1, 4735: 0, 2881: 0, 1409: 0, 4307: 0, 2688: 0, 1316: 0, 3459: 0, 1: 0, 6339: 0, 6337: 1, 34: 1, 1528: 1, 7311: 0, 1042: 0, 4006: 1, 4472: 1, 1162: 1, 3094: 0}, {977: 0, 2986: 1, 6003: 0, 3182: 1, 94: 0, 5081: 0, 2634: 1, 3528: 0, 4254: 1, 4735: 0, 2881: 0, 1409: 0, 4307: 0, 2688: 0, 1316: 0, 3459: 0, 1: 0, 6339: 0, 6337: 1, 34: 1, 1528: 1, 7311: 0, 1042: 1, 4006: 1, 4472: 0, 1162: 0, 3094: 0}, {977: 0, 2986: 0, 6003: 0, 3182: 0, 94: 0, 5081: 0, 2634: 1, 3528: 0, 4254: 1, 4735: 0, 2881: 0, 1409: 0, 4307: 0, 2688: 0, 1316: 1, 3459: 0, 1: 0, 6339: 0, 6337: 1, 34: 1, 1528: 0, 7311: 0, 1042: 1, 4006: 1, 4472: 0, 1162: 0, 3094: 0}, {977: 0, 2986: 0, 6003: 1, 3182: 1, 94: 0, 5081: 0, 2634: 1, 3528: 0, 4254: 1, 4735: 0, 2881: 0, 1409: 0, 4307: 0, 2688: 0, 1316: 1, 3459: 0, 1: 0, 6339: 0, 6337: 1, 34: 1, 1528: 0, 7311: 0, 1042: 1, 4006: 1, 4472: 0, 1162: 0, 3094: 0}, {977: 0, 2986: 1, 6003: 0, 3182: 0, 94: 0, 5081: 0, 2634: 1, 3528: 1, 4254: 1, 4735: 0, 2881: 0, 1409: 1, 4307: 0, 2688: 0, 1316: 0, 3459: 0, 1: 0, 6339: 0, 6337: 1, 34: 0, 1528: 0, 7311: 1, 1042: 1, 4006: 1, 4472: 1, 1162: 1, 3094: 0}, {977: 0, 2986: 1, 6003: 0, 3182: 1, 94: 0, 5081: 0, 2634: 1, 3528: 0, 4254: 1, 4735: 1, 2881: 0, 1409: 0, 4307: 0, 2688: 0, 1316: 0, 3459: 0, 1: 0, 6339: 0, 6337: 1, 34: 0, 1528: 0, 7311: 1, 1042: 1, 4006: 1, 4472: 0, 1162: 1, 3094: 0}, {977: 0, 2986: 0, 6003: 0, 3182: 0, 94: 0, 5081: 1, 2634: 1, 3528: 0, 4254: 1, 4735: 0, 2881: 0, 1409: 0, 4307: 0, 2688: 0, 1316: 0, 3459: 0, 1: 0, 6339: 0, 6337: 1, 34: 1, 1528: 1, 7311: 0, 1042: 1, 4006: 1, 4472: 0, 1162: 0, 3094: 0}, {977: 0, 2986: 0, 6003: 0, 3182: 1, 94: 0, 5081: 1, 2634: 0, 3528: 1, 4254: 1, 4735: 0, 2881: 0, 1409: 0, 4307: 0, 2688: 1, 1316: 1, 3459: 0, 1: 0, 6339: 0, 6337: 1, 34: 0, 1528: 1, 7311: 0, 1042: 1, 4006: 1, 4472: 0, 1162: 0, 3094: 0}, {977: 0, 2986: 1, 6003: 0, 3182: 0, 94: 0, 5081: 1, 2634: 1, 3528: 0, 4254: 1, 4735: 0, 2881: 0, 1409: 0, 4307: 0, 2688: 0, 1316: 0, 3459: 0, 1: 0, 6339: 0, 6337: 1, 34: 1, 1528: 1, 7311: 0, 1042: 1, 4006: 1, 4472: 0, 1162: 0, 3094: 0}, {977: 0, 2986: 1, 6003: 0, 3182: 1, 94: 0, 5081: 1, 2634: 1, 3528: 0, 4254: 1, 4735: 0, 2881: 0, 1409: 0, 4307: 0, 2688: 0, 1316: 0, 3459: 1, 1: 0, 6339: 0, 6337: 1, 34: 1, 1528: 1, 7311: 0, 1042: 1, 4006: 1, 4472: 0, 1162: 0, 3094: 0}, {977: 0, 2986: 0, 6003: 1, 3182: 0, 94: 0, 5081: 1, 2634: 0, 3528: 0, 4254: 1, 4735: 0, 2881: 0, 1409: 0, 4307: 0, 2688: 0, 1316: 0, 3459: 0, 1: 0, 6339: 0, 6337: 1, 34: 0, 1528: 0, 7311: 0, 1042: 1, 4006: 1, 4472: 0, 1162: 0, 3094: 0}, {977: 0, 2986: 0, 6003: 0, 3182: 1, 94: 0, 5081: 1, 2634: 1, 3528: 0, 4254: 1, 4735: 0, 2881: 0, 1409: 0, 4307: 0, 2688: 0, 1316: 1, 3459: 0, 1: 0, 6339: 0, 6337: 1, 34: 1, 1528: 0, 7311: 0, 1042: 1, 4006: 1, 4472: 0, 1162: 0, 3094: 0}, {977: 0, 2986: 1, 6003: 0, 3182: 0, 94: 0, 5081: 1, 2634: 1, 3528: 0, 4254: 1, 4735: 0, 2881: 0, 1409: 0, 4307: 0, 2688: 0, 1316: 0, 3459: 0, 1: 0, 6339: 0, 6337: 1, 34: 1, 1528: 0, 7311: 0, 1042: 1, 4006: 1, 4472: 0, 1162: 0, 3094: 0}, {977: 0, 2986: 1, 6003: 0, 3182: 1, 94: 0, 5081: 1, 2634: 1, 3528: 0, 4254: 1, 4735: 0, 2881: 0, 1409: 0, 4307: 0, 2688: 0, 1316: 0, 3459: 0, 1: 0, 6339: 0, 6337: 1, 34: 1, 1528: 0, 7311: 0, 1042: 1, 4006: 1, 4472: 0, 1162: 0, 3094: 0}, {977: 0, 2986: 0, 6003: 0, 3182: 0, 94: 0, 5081: 0, 2634: 0, 3528: 0, 4254: 1, 4735: 0, 2881: 0, 1409: 0, 4307: 0, 2688: 0, 1316: 1, 3459: 1, 1: 0, 6339: 0, 6337: 1, 34: 0, 1528: 0, 7311: 0, 1042: 0, 4006: 1, 4472: 0, 1162: 0, 3094: 0}, {977: 0, 2986: 0, 6003: 0, 3182: 1, 94: 0, 5081: 0, 2634: 1, 3528: 0, 4254: 1, 4735: 0, 2881: 0, 1409: 0, 4307: 0, 2688: 0, 1316: 1, 3459: 0, 1: 0, 6339: 0, 6337: 1, 34: 1, 1528: 0, 7311: 0, 1042: 1, 4006: 1, 4472: 0, 1162: 0, 3094: 0}, {977: 0, 2986: 1, 6003: 0, 3182: 0, 94: 0, 5081: 0, 2634: 1, 3528: 0, 4254: 1, 4735: 0, 2881: 0, 1409: 0, 4307: 0, 2688: 0, 1316: 0, 3459: 0, 1: 0, 6339: 0, 6337: 1, 34: 1, 1528: 0, 7311: 0, 1042: 1, 4006: 1, 4472: 1, 1162: 0, 3094: 0}, {977: 0, 2986: 1, 6003: 0, 3182: 1, 94: 0, 5081: 0, 2634: 1, 3528: 0, 4254: 1, 4735: 0, 2881: 0, 1409: 0, 4307: 0, 2688: 0, 1316: 0, 3459: 0, 1: 0, 6339: 0, 6337: 1, 34: 1, 1528: 0, 7311: 0, 1042: 1, 4006: 1, 4472: 0, 1162: 0, 3094: 0}, {977: 0, 2986: 0, 6003: 0, 3182: 0, 94: 0, 5081: 0, 2634: 1, 3528: 0, 4254: 1, 4735: 0, 2881: 1, 1409: 0, 4307: 0, 2688: 0, 1316: 1, 3459: 0, 1: 0, 6339: 0, 6337: 0, 34: 1, 1528: 1, 7311: 0, 1042: 1, 4006: 1, 4472: 0, 1162: 0, 3094: 0}]
#known_inputs = [dict()] * 32

# for k_t in known_inputs:
#     print(k_t)

subgraph_gates = netlist.get_module_by_id(451).get_gates(recursive=True)

#A
#net_ids_of_interest = [4805, 1410, 7595, 577, 1911, 7288, 1512, 4599, 5453, 1262, 1349, 1220, 3127, 423, 5563, 190]

#B 
#net_ids_of_interest = [1433, 6038, 1550, 5373, 5058, 7309, 7620, 3752, 1564, 1043, 1254, 769, 974, 3422, 5348, 2910]

#C
#net_ids_of_interest = [6915, 2639, 7365, 4757, 1295, 1542, 2985, 1230, 747, 521, 121, 7260, 5839, 5839, 5839, 5839]

#D
#net_ids_of_interest = [3646, 506, 4530, 4291, 7277, 1173, 1286, 7735, 214, 426, 1551, 1237, 4968, 6484, 6229, 761]

t = 17

from hal_plugins import sequential_symbolic_execution

pl_sse = hal_py.plugin_manager.get_plugin_instance("sequential_symbolic_execution")

nets_of_interest = list()

for net_id in net_ids_of_interest:
    net = netlist.get_net_by_id(net_id)
    nets_of_interest.append(net)
    
for net in nets_of_interest:
    bf = pl_sse.get_value_at(net, t, subgraph_gates, known_inputs)
    print(bf)

    #break
    
bf_vec = pl_sse.get_vec_value_at(nets_of_interest, t, subgraph_gates, known_inputs)
print(bf_vec)

#unload everything hal related
hal_py.plugin_manager.unload_all_plugins()
